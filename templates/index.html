<div class="container mt-5">
  <div class="d-flex justify-content-end mb-3">
    <button id="logout-btn" class="btn btn-secondary">Déconnexion</button>
  </div>
  <h1 class="text-center">D.S.M (Document Summary Medical)</h1>
  <form
    id="upload-form"
    enctype="multipart/form-data"
    method="POST"
    action="/upload"
  >
    <div class="mb-4">
      <label for="file" class="form-label">
        Veuillez insérer un PDF qui sera analysé et stocké
      </label>
      <input type="file" class="form-control" id="file" name="file" required />
      <p class="mt-2">
        <mark>NB:</mark> Veuillez renommer le fichier avec le nom de votre
        patient
      </p>
      <p>------Le Traitement peut prendre un certain temps -------</p>
    </div>

    <button type="submit" class="btn btn-primary mt-3">Summarize</button>
  </form>

  <div id="summary-content" class="mt-4">
    <!-- Le résumé sera affiché ici -->
  </div>
</div>

<script>
  // Gestion du bouton de déconnexion
  const logoutBtn = document.getElementById("logout-btn");
  logoutBtn.addEventListener("click", function () {
    window.location.href = "http://127.0.0.1:3000";
  });

  // Gestion du formulaire
  const form = document.getElementById("upload-form");
  form.addEventListener("submit", async function (event) {
    event.preventDefault();

    // Envoyer le fichier via Fetch
    const formData = new FormData(form);
    const response = await fetch("/upload", {
      method: "POST",
      body: formData,
    });

    const data = await response.json();
    const summaryContent = document.getElementById("summary-content");
    if (data.summary) {
      summaryContent.innerHTML = `<pre>${data.summary}</pre>`;
    } else {
      summaryContent.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
    }
  });
</script>
